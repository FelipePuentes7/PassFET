<!-- C:\Users\felipe\Documents\PassFET\frontend\src\app\auth\recover-password\recover-password.component.html -->

<div class="recovery-container">
  <div class="recovery-box">
    <h2 class="title">Recuperar Contraseña</h2>

    <!-- Mensajes de éxito o error -->
    <div *ngIf="message as msg" [ngClass]="msg.type === 'success' ? 'message success' : 'message error'">
      {{ msg.text }}
    </div>

    <!-- Formulario de Verificación -->
    <form *ngIf="!verificationSuccess" [formGroup]="verificationForm" (ngSubmit)="onVerify()">
      <p class="instructions">Ingresa tus datos para verificar tu identidad.</p>
      
      <div class="input-group">
        <label for="email">Email</label>
        <input id="email" type="email" formControlName="email" placeholder="tu@email.com">
        <div *ngIf="verificationForm.get('email')?.invalid && verificationForm.get('email')?.touched" class="error-text">
          <small *ngIf="verificationForm.get('email')?.errors?.['required']">El email es requerido.</small>
          <small *ngIf="verificationForm.get('email')?.errors?.['email']">Formato de email inválido.</small>
        </div>
      </div>

      <div class="input-group">
        <label for="cedula">Número de Cédula</label>
        <input id="cedula" type="text" formControlName="cedula" placeholder="123456789">
        <div *ngIf="verificationForm.get('cedula')?.invalid && verificationForm.get('cedula')?.touched" class="error-text">
           <small *ngIf="verificationForm.get('cedula')?.errors?.['required']">La cédula es requerida.</small>
           <small *ngIf="verificationForm.get('cedula')?.errors?.['pattern']">Solo se admiten dígitos.</small>
        </div>
      </div>

      <div class="input-group">
        <label for="student_code">Código de Estudiante</label>
        <input id="student_code" type="text" formControlName="student_code" placeholder="Código">
         <div *ngIf="verificationForm.get('student_code')?.invalid && verificationForm.get('student_code')?.touched" class="error-text">
           <small>El código es requerido.</small>
        </div>
      </div>

      <button type="submit" class="btn-submit" [disabled]="isLoading">
        {{ isLoading ? 'Verificando...' : 'Verificar' }}
      </button>
    </form>

    <!-- Formulario de Nueva Contraseña -->
    <form *ngIf="verificationSuccess" [formGroup]="resetForm" (ngSubmit)="onReset()">
       <p class="instructions">Verificación exitosa. Ahora puedes crear una nueva contraseña.</p>

      <div class="input-group">
        <label for="password">Nueva Contraseña</label>
        <input id="password" type="password" formControlName="password">
        <div *ngIf="resetForm.get('password')?.invalid && resetForm.get('password')?.touched" class="error-text">
           <small *ngIf="resetForm.get('password')?.errors?.['required']">La contraseña es requerida.</small>
           <small *ngIf="resetForm.get('password')?.errors?.['minlength']">Debe tener al menos 8 caracteres.</small>
        </div>
      </div>

      <div class="input-group">
        <label for="confirmPassword">Confirmar Nueva Contraseña</label>
        <input id="confirmPassword" type="password" formControlName="confirmPassword">
        <div *ngIf="resetForm.errors?.['passwordMismatch'] && resetForm.get('confirmPassword')?.touched" class="error-text">
           <small>Las contraseñas no coinciden.</small>
        </div>
      </div>
      
      <button type="submit" class="btn-submit" [disabled]="isLoading">
        {{ isLoading ? 'Actualizando...' : 'Actualizar Contraseña' }}
      </button>
    </form>

    <div class="footer-link">
      <a routerLink="/login">Volver al inicio de sesión</a>
    </div>
  </div>
</div>
