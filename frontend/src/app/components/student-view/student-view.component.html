<div class="student-layout-container" [class.sidebar-open]="!isSidebarCollapsed">
  <!-- Barra Lateral -->
  <aside class="sidebar" [class.collapsed]="isSidebarCollapsed">
    <div class="sidebar-header" (click)="toggleSidebar()">
      <img src="assets/images/logofet.png" alt="Logo FET" class="logo">
      <span class="logo-text" *ngIf="!isSidebarCollapsed">FET</span>
    </div>
    
    <nav class="sidebar-nav">
      <a routerLink="/student/dashboard" routerLinkActive="active" class="nav-item" title="Tareas">
        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="9" y1="3" x2="9" y2="21"></line>
        </svg>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Tareas</span>
      </a>
      
      <a routerLink="/student/historial" routerLinkActive="active" class="nav-item" title="Historial de Entregas">
        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 3h7v7H3z"></path>
          <path d="M14 3h7v7h-7z"></path>
          <path d="M14 14h7v7h-7z"></path>
          <path d="M3 14h7v7H3z"></path>
        </svg>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Historial</span>
      </a>
    </nav>
    
    <div class="sidebar-footer">
      <a (click)="logout()" class="nav-item logout-btn" title="Cerrar Sesión">
        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Cerrar Sesión</span>
      </a>
    </div>
  </aside>

  <!-- Contenido Principal -->
  <div class="main-content-wrapper">
    <header class="main-header">
      <button class="menu-toggle-btn" (click)="toggleSidebar()" title="Menú">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
      <div class="header-content">
        <h1 class="header-title">Panel de Estudiante</h1>
        <p class="header-subtitle">Gestión de Pasantías FET</p>
      </div>
      
      <div class="header-actions">
        <div class="user-info">
          <div class="user-avatar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <span class="user-name">Estudiante</span>
        </div>
      </div>
    </header>
    
    <main class="content-area">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <div class="spinner"></div>
        <p>Cargando información...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !isLoading" class="error-state">
        <svg class="error-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <p class="error-message">{{ error }}</p>
        <button class="btn-retry" (click)="loadInitialData()">Reintentar</button>
      </div>

      <!-- Main Content -->
      <div *ngIf="!isLoading && !error" class="content-wrapper">
        
        <!-- Pasantía Info Card -->
        <div *ngIf="pasantia" class="card pasantia-info">
          <div class="card-header">
            <h2 class="card-title">{{ pasantia.titulo }}</h2>
            <span class="status-badge" [class]="'status-' + pasantia.estado">{{ pasantia.estado }}</span>
          </div>
          <div class="card-body">
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Tutor:</span>
                <span class="info-value">{{ pasantia.tutor?.name || 'No asignado' }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Empresa:</span>
                <span class="info-value">{{ pasantia.nombre_empresa || 'N/A' }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Fecha Inicio:</span>
                <span class="info-value">{{ pasantia.fecha_inicio | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Fecha Fin:</span>
                <span class="info-value">{{ pasantia.fecha_fin | date:'dd/MM/yyyy' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- No Pasantía Message -->
        <div *ngIf="!pasantia" class="empty-state">
          <svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9 2v6"></path>
            <path d="M15 2v6"></path>
            <path d="M12 11v6"></path>
            <rect x="3" y="4" width="18" height="18" rx="2"></rect>
          </svg>
          <h3>No tienes una pasantía asignada</h3>
          <p>Contacta con tu coordinador para más información.</p>
        </div>

        <!-- Tareas Section -->
        <div *ngIf="pasantia" class="tareas-section">
          <div class="section-header">
            <h3 class="section-title">Tareas Asignadas</h3>
            <span class="task-count">{{ tareas.length }} tarea(s)</span>
          </div>

          <!-- Tareas List -->
          <div *ngIf="tareas.length > 0; else noTareas" class="tareas-grid">
            <div *ngFor="let tarea of tareas; let i = index" class="card task-card">
              <div class="task-header">
                <h4 class="task-title">{{ tarea.titulo }}</h4>
                <span class="status-badge" [ngClass]="'status-' + tarea.status">
                  {{ getStatusLabel(tarea.status) }}
                </span>
              </div>
              
              <div class="task-body">
                <p class="task-description">{{ tarea.descripcion }}</p>
                
                <div class="task-meta">
                  <div class="meta-item" *ngIf="tarea.fecha_entrega">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>Vence: {{ tarea.fecha_entrega | date:'dd/MM/yyyy' }}</span>
                  </div>
                </div>

                <!-- Submit Form (if pending) -->
                <div *ngIf="tarea.status === 'pendiente'" class="submit-section">
                  <div class="divider"></div>
                  <h5 class="submit-title">Entregar Tarea</h5>
                  
                  <form (ngSubmit)="submitTask(tarea.id)" class="submit-form">
                    <div class="form-group">
                      <label [for]="'comentario-' + tarea.id">Comentario:</label>
                      <textarea 
                        [id]="'comentario-' + tarea.id"
                        [(ngModel)]="comentarioEstudiante" 
                        [name]="'comentario-' + tarea.id"
                        rows="3"
                        placeholder="Escribe un comentario sobre tu entrega..."></textarea>
                    </div>
                    
                    <div class="form-group">
                      <label [for]="'archivo-' + tarea.id">Subir archivo:</label>
                      <input 
                        type="file" 
                        [id]="'archivo-' + tarea.id"
                        (change)="onFileSelected($event)"
                        class="file-input">
                      <span *ngIf="selectedFile" class="file-name">{{ selectedFile.name }}</span>
                    </div>
                    
                    <button type="submit" class="btn-primary">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13"></path>
                        <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                      </svg>
                      Entregar Tarea
                    </button>
                  </form>
                </div>

                <!-- Submission Details (if submitted) -->
                <div *ngIf="tarea.status !== 'pendiente' && tarea.entrega" class="entrega-section">
                  <div class="divider"></div>
                  <h5 class="entrega-title">Tu Entrega</h5>
                  
                  <div class="entrega-details">
                    <div class="detail-item">
                      <span class="detail-label">Entregado:</span>
                      <span class="detail-value">
                        {{ tarea.entrega.fecha_entrega | date:'dd/MM/yyyy h:mm a' }}
                        <span *ngIf="tarea.entrega.is_late" class="badge badge-late">Tardía</span>
                        <span *ngIf="!tarea.entrega.is_late" class="badge badge-ontime">A tiempo</span>
                      </span>
                    </div>
                    
                    <div class="detail-item" *ngIf="tarea.entrega.comentario_estudiante">
                      <span class="detail-label">Tu comentario:</span>
                      <span class="detail-value">{{ tarea.entrega.comentario_estudiante }}</span>
                    </div>
                    
                    <div class="detail-item" *ngIf="tarea.entrega.archivo_path">
                      <span class="detail-label">Archivo:</span>
                      <a [href]="'http://localhost:8000/storage/' + tarea.entrega.archivo_path" 
                         target="_blank" 
                         class="file-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                          <polyline points="7 10 12 15 17 10"></polyline>
                          <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Descargar archivo
                      </a>
                    </div>

                    <!-- Tutor Feedback -->
                    <div class="feedback-section" *ngIf="tarea.entrega.calificacion || tarea.entrega.comentario_tutor">
                      <div class="feedback-divider"></div>
                      <h6 class="feedback-title">Feedback del Tutor</h6>
                      
                      <div class="detail-item" *ngIf="tarea.entrega.calificacion">
                        <span class="detail-label">Calificación:</span>
                        <span class="detail-value grade">{{ tarea.entrega.calificacion }}</span>
                      </div>
                      
                      <div class="detail-item" *ngIf="tarea.entrega.comentario_tutor">
                        <span class="detail-label">Comentario:</span>
                        <span class="detail-value">{{ tarea.entrega.comentario_tutor }}</span>
                      </div>
                    </div>
                    
                    <div *ngIf="!tarea.entrega.calificacion && !tarea.entrega.comentario_tutor" class="pending-review">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                      </svg>
                      <span>Esperando revisión del tutor</span>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <!-- No Tareas Template -->
          <ng-template #noTareas>
            <div class="empty-state">
              <svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
              </svg>
              <h3>No hay tareas asignadas</h3>
              <p>Aún no tienes tareas para esta pasantía.</p>
            </div>
          </ng-template>
        </div>

      </div>
    </main>
  </div>
</div>