<div class="student-view-container">
  <header class="page-header">
    <h1>Vista del Estudiante</h1>
    <a routerLink="/student/historial" class="btn-secondary">Ver Historial de Calificaciones</a>
  </header>

  <div *ngIf="isLoading" class="loading-state"><p>Cargando...</p></div>
  <div *ngIf="error" class="error-state"><p>{{ error }}</p></div>

  <div *ngIf="!isLoading && !error && pasantia">
    <div class="card pasantia-info">
      <h2>{{ pasantia.titulo }}</h2>
      <p><strong>Tutor:</strong> {{ pasantia.tutor?.name || 'No asignado' }}</p>
      <p><strong>Empresa:</strong> {{ pasantia.nombre_empresa }}</p>
      <p><strong>Estado:</strong> {{ pasantia.estado }}</p>
    </div>

    <h3>Tareas Asignadas</h3>
    <div *ngIf="tareas.length > 0; else noTareas">
      <div *ngFor="let tarea of tareas" class="card task-card">
        <h4>{{ tarea.titulo }}</h4>
        <p>{{ tarea.descripcion }}</p>
        <p><strong>Estado:</strong> <span class="status-badge status-{{tarea.status}}">{{ tarea.status }}</span></p>

        <div *ngIf="tarea.status === 'pendiente'">
          <h5>Entregar Tarea</h5>
          <form (ngSubmit)="submitTask(tarea.id)">
            <div class="form-group">
              <label for="comentario">Comentario:</label>
              <textarea id="comentario" [(ngModel)]="comentarioEstudiante" name="comentario" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="archivo">Subir archivo:</label>
              <input type="file" id="archivo" (change)="onFileSelected($event)">
            </div>
            <button type="submit" class="btn-primary">Entregar</button>
          </form>
        </div>

        <div *ngIf="tarea.status === 'por revisar' || tarea.status === 'entregado'">
          <h5>Tu Entrega</h5>
          <div *ngIf="tarea.entrega">
            <p>
              <strong>Entregado:</strong> {{ tarea.entrega.fecha_entrega | date:'dd/MM/yyyy h:mm a' }}
              <span *ngIf="tarea.entrega.is_late" class="badge badge-tardia">Tardía</span>
              <span *ngIf="!tarea.entrega.is_late" class="badge badge-a-tiempo">A tiempo</span>
            </p>
            <p><strong>Comentario:</strong> {{ tarea.entrega.comentario_estudiante || 'N/A' }}</p>
            <p *ngIf="tarea.entrega.archivo_path"><strong>Archivo:</strong> <a [href]="'http://localhost:8000/storage/' + tarea.entrega.archivo_path" target="_blank">Descargar</a></p>
            <hr>
            <h5>Feedback del Tutor</h5>
            <p><strong>Calificación:</strong> {{ tarea.entrega.calificacion || 'Pendiente' }}</p>
            <p><strong>Comentario:</strong> {{ tarea.entrega.comentario_tutor || 'N/A' }}</p>
          </div>
        </div>

      </div>
    </div>
    <ng-template #noTareas><p>No hay tareas asignadas para esta pasantía.</p></ng-template>

  </div>

  <div *ngIf="!isLoading && !pasantia">
    <p>No tienes una pasantía asignada.</p>
  </div>
</div>
